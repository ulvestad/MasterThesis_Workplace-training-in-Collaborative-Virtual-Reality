%===================================== CHAP 6 =================================

\chapter{Phase 2:  Main development}
\label{chap:phase2}

\section{Planning and Changes}


\subsection{Change 1}
Voice chat will be implemented. Customise avatar before joining in some fashion.

\subsection{Updated Requirements}

\begin{enumerate}
  \setlength\itemsep{0em}
  \item [\textbf{F1}] The applications must allow multiple players to join the same scene.
  \item [\textbf{F2}] Interactable objects must be serialised and and synchronised over the network.
  \item [\textbf{F3}] A player shall be represented as a avatar with corresponding movement from the VR world to the real world.
  \item [\textbf{F4}] The application must offer the option of using VR equipment or desktop mode (mouse and keyboard) for interaction.
  \item [\textbf{F5}] The application must contain a scene with tasks enabling collaborative learning.
  \item [\textbf{F6}] Users should be able to interact with the environment.
  \item [\textbf{F7}] Users should be able to communicate through integrated voice chat functionality.
\end{enumerate}

\subsection{Development Decisions}
The largest difference between phase one and phase two is the environment and the tasks available to the users. While phase one focused on a functional multi user implementation to showcase possibilities and to see that users could navigate and understand a collaborative VR environment, phase two is about creating a functional collaborative workplace. With this, the goal is to create an artefact that is as close as possible to what would be used in a normal use case, but with multi user functionality. 

For the virtual workplace to be used in this phase, a workplace developed at the IMTEL lab was chosen based on several criteria. Due to the time frame of the project, it was decided that a new workplace would not be created. Instead, the choice was made to use one already developed at the IMTEL lab, as that would allow us to ask questions to the developers regarding any issues that might occur. 

Secondly was the issue of scope and complexity. To properly test the possibilities of collaboration in VR, there needed to be a proper set of tasks that were neither to small nor too large. Too small, and the testers would finish it in no time, or the space might feel cramped. Too large, and there might be unforeseen issues implementing collaboration elements or for testers navigating the space together. Since the applications would not be developed from the ground up, a larger and more complex application could also create issues when trying to serialise all the necessary information and states per task and player. Using more limited applications would allow more time to work on individual serialisation to make sure that the application maintained consistency across the clients of all currently connected users. 

The recency of the workplace was also a concern. Due to the nature of the collaboration between the IMTEL lab and NAV, the developers of the older projects are not necessarily ready, or available at all, to help with issues, even if the application was made at the lab. As such, it would be helpful to use a fairly new workplace.

Considering these criteria, the newly developed car mechanic workplace was chosen. In this workplace, the users can attempt several different tasks in a garage, with the aim of introducing the user to some of the tasks a car mechanic might face in a normal workday  \textcolor{red}{CITE IMTEL PAPER OM  MECHANIC WORKPLACE HER}.

\subsubsection{VR}
\textcolor{red}{Skrive litt om laser/pointers, avatarer etc, ting vi har gjort for immersion/presence}
In response to feedback, several decisions were made in this phase to enhance the experience of the individual users, and how they could interact in VR. This included altering the avatars to be less grey and dull, so that they would not blend into the environment as much. They were also given a hat so that their silhouette would be more distinct. Finding a way to let players highlight either their own location or the location of a specific object was also taking into consideration, and was decided to be implemented as long as time allowed for it. 

perhaps most important was the possibility of direct communication. To begin with, direct voice chat has been implemented in the application. The effect on collaboration with voice chat would have to be investigated before adding more features to it, so certain Quality of Life features such as speech indicators or low fidelity animations to indicate speech could be implemented later based on time and further feedback. If users feel that it is hard to figure who is talking, or where the other users are, the importance of these features can be adjusted to more accurately reflect their perceived value to the overall application.


\section{Implementation}
As the implementation got started, it was obvious that some sort of triage needed to be performed. The overall application was broken into its composite pieces, and to the highest degree possible, components were separated and isolated. In the case of the car mechanic application, it consisted of two main scenes, one small and one large. First was the wardrobe, where players had to equip the proper equipment before heading into the garage proper. There wasn't too much happening here, so to begin with the only thing implemented was the ability for the multiple players to enter the garage through the door.

Once inside the garage, the meat of the matter becomes prevalent. The garage contains four separate cars that all have various tasks assigned to them. These were from the start designed separately, with no overlap, which made it easy to focus on one of them at a time. Making sure that each task worked over the network had varying degrees of complexity, largely dependant on the tasks' original complexity. For each of the task, understanding the code was essential. This led to some time being spent on each task simply breaking down the code and structure of each game object. Once thoroughly understood, the basic networking pieces could then be added, and the necessary components and scripts switched out for new, networked variants created in phase one (See chapter \ref{chap:phase1}). For those tasks that required further networking, or had some state that needed to be uniquely maintained, new scripts were created as required, while still aiming to maintain simplicity.  In so far as it was possible, adherence to certain principles was kept a high priority. \textcolor{red}{DRA INN MASSE PROGARK KUNNSKAP HER}


\subsection{Improving the serialisation of network objects}
For those objects that did not fit neatly into the basic entity types, it becomes necessary to create a Photon View script specific to that object that describes how the object is supposed to transfer its' data over the network to the other clients. When that is done, it is important to remember that since serialisation needs to be done manually, so does other things, like lag compensation. If the object also has triggers or other important changes that depend on user input, remote procedure calls from the Photon API can be very handy. It allows the player to request other clients to perform certain procedures remotely, hence the name. Using these RPCs, the state of the tasks can then be easily maintained across all clients, even with more complex state and triggers.



\subsection{Optimisation} \label{subsec:Optimisation}



\subsection{Challenges}
One of the more complex challenges encountered was the fact that the workplace being enabled to function with multiple users was simply not designed from the start with this in mind. This meant that certain scripts needed to be altered to function while networked, and a discussion was had regarding the validity of the tasks as collaborative work. However, as mentioned in section \ref{section:CSCL}, the act of collaborating in itself can bring about better learning through simply discussing and bouncing ideas off another person. A task need not necessarily be created for multiple users for a group to gain benefits from solving it together.


\section{Second Evaluation}

\subsection{User test data}




\subsection{Analysis}


\subsubsection{Interacting in VR}



\subsubsection{Improving realism}




\cleardoublepage