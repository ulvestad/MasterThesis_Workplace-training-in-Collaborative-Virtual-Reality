%===================================== CHAP 6 =================================

\chapter{Phase 2:  Main development}
\label{chap:phase2}

After the exploratory phase 1, phase 2 is more concerned with gathering concrete data. Functional requirements have been revised as a result of data gathered in phase 1, and more focus will be placed on creating a solid foundation as one of the major artefacts of the project. As the data in phase 1 indicated strongly toward a preference for multi-user experiences for workplace training, phase 2 can proceed mostly as planned.

By spending a lot of time with the tools selected for the project in the first phase, it has become apparent as to why a general solution is needed. While some custom logic will always be needed, the overarching plan for the NAV project is to create a \textit{workplace experience catalogue} that will allow users to browse workplaces as needed. It's therefore paramount that the experience is the same to satisfy user expectations. A general solution will also produce clearer results that are not muddied by having different parts of the application respond, operate or appear differently. Less time can be spent creating fundamental logic, and more time spent on making sure that the custom logic parts work well.

With this mind, the development work can be said to be split into two parts. One part will concern itself will implementing and creating a fully functional multi-user workplace experience as one of the two primary artefacts of the project. The other artefact and effort will be devoted to creating the general framework and mapping the process needed to convert a workplace experience to multi-user environment. As the artefacts created here will serve as a foundation for further development and research, a significant portion of time has been spent making sure that the artefacts created are up to the IMTEL lab standards, as well as following software architecture principles. In section \ref{} the details of this process will be explained. The following sections will detail the specific changes made to the artefact concerning the fully implemented workplace.


\section{Planning and Changes}


\subsection{Change 1}
Voice chat will be implemented. Customise avatar before joining in some fashion.

\subsection{Updated Requirements}

\begin{enumerate}
  \setlength\itemsep{0em}
  \item [\textbf{F1}] The applications must allow multiple players to join the same scene.
  \item [\textbf{F2}] Interactable objects must be serialised and and synchronised over the network.
  \item [\textbf{F3}] A player shall be represented as a avatar with corresponding movement from the VR world to the real world.
  \item [\textbf{F4}] The application must offer the option of using VR equipment or desktop mode (mouse and keyboard) for interaction.
  \item [\textbf{F5}] The application must contain a scene with tasks enabling collaborative learning.
  \item [\textbf{F6}] The application must offer the option of using VR equipment or desktop mode(mouse and keyboard) for interaction.
  \item [\textbf{F7}] Users should be able to interact with the environment.
  \item [\textbf{F8}] Users should be able to communicate through integrated voice chat functionality.
\end{enumerate}

\subsection{Development Decisions}
The largest difference between phase one and phase two is the environment and the tasks available to the users. While phase one focused on a functional multi user implementation to showcase possibilities and to see that users could navigate and understand a collaborative VR environment, phase two is about creating a functional collaborative workplace. With this, the goal is to create an artefact that is as close as possible to what would be used in a normal use case, but with multi user functionality. 

For the virtual workplace to be used in this phase, a workplace developed at the IMTEL lab was chosen based on several criteria. Due to the time frame of the project, it was decided that a new workplace would not be created. Instead, the choice was made to use one already developed at the IMTEL lab, as that would allow us to ask questions to the developers regarding any issues that might occur. 

Secondly was the issue of scope and complexity. To properly test the possibilities of collaboration in VR, there needed to be a proper set of tasks that were neither to small nor too large. Too small, and the testers would finish it in no time, or the space might feel cramped. Too large, and there might be unforeseen issues implementing collaboration elements or for testers navigating the space together. Since the applications would not be developed from the ground up, a larger and more complex application could also create issues when trying to serialise all the necessary information and states per task and player. Using more limited applications would allow more time to work on individual serialisation to make sure that the application maintained consistency across the clients of all currently connected users. 

The recency of the workplace was also a concern. Due to the nature of the collaboration between the IMTEL lab and NAV, the developers of the older projects are not necessarily ready, or available at all, to help with issues, even if the application was made at the lab. As such, it would be helpful to use a fairly new workplace.

Considering these criteria, the newly developed car mechanic workplace was chosen. In this workplace, the users can attempt several different tasks in a garage, with the aim of introducing the user to some of the tasks a car mechanic might face in a normal workday  \textcolor{red}{CITE IMTEL PAPER OM  MECHANIC WORKPLACE HER}.

\subsubsection{VR}
\textcolor{red}{Skrive litt om laser/pointers, avatarer etc, ting vi har gjort for immersion/presence}
In response to feedback, several decisions were made in this phase to enhance the experience of the individual users, and how they could interact in VR. This included altering the avatars to be less grey and dull, so that they would not blend into the environment as much. They were also given a hat so that their silhouette would be more distinct. Finding a way to let players highlight either their own location or the location of a specific object was also taken into consideration. After some discussion, the decision was made to implement a form of laser pointer that can be activated for each player. The laser has significantly more accuracy than the standard hand, and can be used to pinpoint rather small objects. 

Perhaps most important was the possibility of direct communication. To begin with, direct voice chat has been implemented in the application. The effect on collaboration with voice chat would have to be investigated before adding more features to it, so certain Quality of Life features such as speech indicators or low fidelity animations to indicate speech could be implemented later based on time and further feedback. If users feel that it is hard to figure out who is talking, or where the other users are, the importance of these features can be adjusted to more accurately reflect their perceived value to the overall application.


\section{Implementation}
As the implementation got started, it was obvious that some sort of triage needed to be performed. The overall application was broken into its composite pieces, and to the highest degree possible, components were separated and isolated. In the case of the car mechanic application, it consisted of two main scenes, one small and one large. First was the wardrobe, where players had to equip the proper equipment before heading into the garage proper. There wasn't too much happening here, so to begin with the only thing implemented was the ability for the multiple players to enter the garage through the door.

Once inside the garage, the meat of the matter becomes prevalent. The garage contains four separate cars that all have various tasks assigned to them. These were from the start designed separately, with no overlap, which made it easy to focus on one of them at a time. Making sure that each task worked over the network had varying degrees of complexity, largely dependant on the tasks' original complexity. For each of the task, understanding the code was essential. This led to some time being spent on each task simply breaking down the code and structure of each game object. Once thoroughly understood, the basic networking pieces could then be added, and the necessary components and scripts switched out for new, networked variants created in phase one (See chapter \ref{chap:phase1}). For those tasks that required further networking, or had some state that needed to be uniquely maintained, new scripts were created as required, while still aiming to maintain simplicity.  In so far as it was possible, adherence to certain principles was kept a high priority. \textcolor{red}{DRA INN MASSE PROGARK KUNNSKAP HER}


\subsection{Improving the serialisation of network objects}
For those objects that did not fit neatly into the basic entity types, it becomes necessary to create a Photon View script specific to that object that describes how the object is supposed to transfer its' data over the network to the other clients. When that is done, it is important to remember that since serialisation needs to be done manually, so does other things, like lag compensation. If the object also has triggers or other important changes that depend on user input, remote procedure calls from the Photon API can be very handy. It allows the player to request other clients to perform certain procedures remotely, hence the name. Using these RPCs, the state of the tasks can then be easily maintained across all clients, even with more complex state and triggers.



\subsection{Optimisation} \label{subsec:Optimisation}
\textcolor{red}{RPCalls and bugfixing}
Over the course of the implementation of the artefacts, areas that could be improved and bugs that could be fixed appeared. As they were noticed, or certain parts caused issues, the issues were taken note of and general implementation continued. If a bug or piece of code was hindering the implementation it would be fixed as needed, otherwise left for later. At the tail end of the phase, they were prioritised and ordered, and they could then be fixed, one at a time. Among these were improvements to level loading, missing collision detectors for certain items, incorrectly synchronised objects, etc. Multiple passes were made to make sure that remote procedure calls were not being sent multiple times or being looped by firing other users' event handlers and so on. 

A helper method has also been created to help keep the code general. Instead of creating a new remote procedure call every time one is needed, one can simply pass the desired method call as a argument to the helper, and the method will initiate the desired remote procedure call. 



\subsection{Challenges}
One of the more complex challenges encountered was the fact that the workplace being enabled to function with multiple users was simply not designed from the start with this in mind. This meant that certain scripts needed to be altered to function while networked, and a discussion was had regarding the validity of the tasks as collaborative work. However, as mentioned in section \ref{section:CSCL}, the act of collaborating in itself can bring about better learning through simply discussing and bouncing ideas off another person. A task need not necessarily be created for multiple users for a group to gain benefits from solving it together.


\section{Second Evaluation}


In order to evaluate the collaborative features we developed for this phase we utilised a reliable and well established method called system usability scale (or SUS). The scale gives a number representing a composite measure of the overall usability of the system being studied \cite{brooke1996sus}. In order for SUS to have the best result it is important that the test is performed before any discussion around the trial of the system takes place, which is why in our evaluation it was at the  top of the questions. 


\subsection{User test data}




\subsection{Analysis}


\subsubsection{Interacting in VR}



\subsubsection{Improving realism}




\cleardoublepage